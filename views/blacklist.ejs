<!DOCTYPE html>
<html lang="nl-BE">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Blacklist | Lord Of The Coders</title>
    <link rel="stylesheet" href="css/reset.css" />
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
      rel="nofollow"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/blacklist.css" />
    <script src="javascript/hamburger-menu.js" defer></script>
    <link
      rel="icon"
      type="image/x-icon"
      href="/assets/lord-of-the-coders-logo.png"
    />
    <audio autoplay loop>
      <!-- https://archive.org/details/TheLordOfTheRings_OST -->
      <source src="/assets/theshire.mp3" type="audio/mpeg" />
    </audio>
    <script src="/javascript/export-csv.js" defer></script>
    <script>
      function exportBlacklistTXT(data, filename) {
        let text = '';
        data.forEach(function(item, idx) {
          text += `Q: "${item.quote}"
A: ${item.answer}
R: ${item.reason}\n\n`;
        });
        const blob = new Blob([text], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }
    </script>
  </head>
  <body>
    <%- include("partials/header") %>
    <main>
      <section class="kader">
        <h2 class="title">Blacklist</h2>
        <button class="btn btn-success mb-3" id="exportBlacklistTXT">Print to TXT</button>
        <section class="list">
          
          
          <article class="listkader">
            <h2>Quote (Q)</h2>
            <h2>Answer (A)</h2>
            <h2>Reden (R)</h2>
          </article>
          
         <% for (let i = 0; i < blacklistArray.length; i++) {
           console.log(blacklistArray.length);
            console.log(characterArray.length);
            
            const quote = blacklistArray[i].quote;
            const answer = characterArray[i].name;
            const reason = blacklistArray[i].reason;
          %>
          <article class="listkader">
            <h4>Q: "<%= quote %>"</h4>
            <h4>A: <%= answer %></h4>
            <h5>R: <%= reason %>
              <form action="/blacklist/edit/<%=id %>" method="POST" style="display:inline;">
                <button type="submit" class="btn btn-primary">Edit</button>
              </form>  <form action="/blacklist/delete/<%= blacklistArray[i]._id %>" method="POST" style="display:inline;">
              <button type="submit" class="btn btn-danger">Delete</button>
            </form>
              </h5>
          
          </article>
          <%  }  %>
          <% if (blacklistArray.length === 0) { %>
          <article class="listkader">
            <h4>Er zijn momenteel geen quotes in de blacklist.</h4>
          </article>
          <%  
          
         } %>
          
        </section>
      </section>
    </main>
    <% const blacklistExportData = blacklistArray.map(function(item, i) {
      return {
        quote: item.quote,
        answer: characterArray[i] ? characterArray[i].name : '',
        reason: item.reason
      };
    }); %>
    <script>
      window.blacklistData = <%- JSON.stringify(blacklistExportData) %>;
      document.getElementById('exportBlacklistTXT').addEventListener('click', function() {
        exportBlacklistTXT(window.blacklistData, 'blacklist.txt');
      });
    </script>
    <%- include("partials/footer") %>
  </body>
</html>